using (ScriptAPI) {
    f = AddByte("function");

    switch ((int)f) {
        case 1: // equip
            AddInt("EquipSlot");
            AddLong("ItemUid");
        case 2: // unequip
            AddInt("EquipSlot");
        case 3: // stage upgrade
            AddLong("ItemUid"); // 0 while equipped
            AddInt("ItemId");
            AddInt("EquipSlot");
        case 4: // stage upgrade catalysts
            AddLong("TargetItemUid"); // 0 while equipped
            AddInt("TargetItemId");
            AddInt("TargetEquipSlot");
            AddInt("CatalystAmount");
        case 5: // upgrade (Target is the lapenshard being upgraded)
            AddLong("TargetItemUid"); // 0 while equipped
            AddInt("TargetItemId");
            AddInt("TargetEquipSlot");
            count = AddInt("count");
            for (i = 0; i < count; i++) {
                StartNode("catalyst");
                AddLong("CatalystItemUid");
                AddInt("CatalystAmount");
                EndNode(true);
            }
        case 6:
            AddInt("Unknown");
    }
}