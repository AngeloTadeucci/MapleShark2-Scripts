using (ScriptAPI) {
    f = AddByte("Function");
    switch((int)f) {
        case 0: // Add
            // BROADCAST
            AddInt("PlayerObjectId");
            AddInt("PetObjectId");
            b = AddBool("Bool");
            if (b) {
                id = AddInt("PetItemId");
                AddLong("PetUid");
                AddInt("Rarity");
                DecodeItem(id);
                AddLong("PetUid");
            }
        case 1: // Remove
            // BROADCAST
            AddInt("PlayerObjectId");
            AddLong("PetUid");
	    case 5:
		    AddInt("PlayerObjectId");
		    DecodePotionSettings();
		case 6:
		    AddInt("PlayerObjectId");
		    DecodeLootSettings();
        case 7: // load collection
            count = AddInt("Count");
            for (i = 0; i < count; i++) {
                AddInt("PetId");
                AddShort("PetRarity");
            }
        case 9:
            AddInt("PlayerObjectId");
            AddUnicodeString("PetName");
            AddLong("PetExp");
            AddInt("Unknown");
            AddShort("Unknown");
            AddShort("Unknown");
            AddShort("Unknown");
            DecodePotionSettings();
            DecodeLootSettings();
        case 20: // use master snare
            AddInt("ItemId"); // Lapis master snare
    }
}

function DecodePotionSettings() {
	StartNode("PotionSettings");
	count = AddByte("Count");
    for (i = 0; i < count; i++) {
	    StartNode("Potion " + i);
        AddInt("ThresholdIndex");
        AddFloat("Threshold");
        AddInt("ItemId");
	    EndNode(true);
    }
	EndNode(true);
}

function DecodeLootSettings() {
	StartNode("LootSettings");
	AddBool("Mesos");
    AddBool("Merets");
    AddBool("Other");
    AddBool("Currency");
    AddBool("Equipment");
    AddBool("Consumable");
    AddBool("Gemstone");
    AddBool("Dropped");
    AddInt("MinRarity");
    AddBool("Enabled");
	EndNode(true);
}